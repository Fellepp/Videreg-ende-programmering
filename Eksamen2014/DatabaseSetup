DROP TABLE IF EXISTS RUTETRASE;
DROP TABLE IF EXISTS STOPPESTED;
DROP TABLE IF EXISTS BANE;
DROP TABLE IF EXISTS RUTE;
DROP TABLE IF EXISTS STASJON;
DROP TABLE IF EXISTS KOMMUNE;

CREATE TABLE STASJON(
  stasjonsnr SMALLINT,
  navn CHAR(30) NOT NULL,
  hoyde INTEGER NOT NULL,
  kommunenr SMALLINT NOT NULL,
  CONSTRAINT pk_stasjon PRIMARY KEY(stasjonsnr)
);
CREATE TABLE KOMMUNE(
  kommunenr SMALLINT,
  navn CHAR(30) NOT NULL,
  fylke CHAR(50) NOT NULL,
  CONSTRAINT pk_kommune PRIMARY KEY(kommunenr)
);
CREATE TABLE BANE(
  banenavn CHAR(30),
  endestasjon1 SMALLINT NOT NULL,
  endestasjon2 SMALLINT NOT NULL,
  CONSTRAINT pk_bane PRIMARY KEY(banenavn)
);
CREATE TABLE RUTE(
  rutenr SMALLINT,
  endestasjon1 SMALLINT NOT NULL,
  endestasjon2 SMALLINT NOT NULL,
  CONSTRAINT pk_rute PRIMARY KEY(rutenr)
);
CREATE TABLE RUTETRASE(
  rutenr SMALLINT,
  banenavn CHAR(30),
  CONSTRAINT pk_rutetrase PRIMARY KEY(rutenr,banenavn)
);
CREATE TABLE STOPPESTED(
  rutenr SMALLINT,
  stoppnr SMALLINT,
  stasjonsnr SMALLINT NOT NULL,
  CONSTRAINT pk_stoppested PRIMARY KEY(rutenr,stoppnr)
);
ALTER TABLE STASJON
  ADD CONSTRAINT stasjon_fk1 FOREIGN KEY(kommunenr)
REFERENCES KOMMUNE (kommunenr);
ALTER TABLE BANE
  ADD CONSTRAINT bane_fk1 FOREIGN KEY(endestasjon1)
REFERENCES STASJON (stasjonsnr);
ALTER TABLE BANE
  ADD CONSTRAINT bane_fk2 FOREIGN KEY(endestasjon2)
REFERENCES STASJON (stasjonsnr);
ALTER TABLE RUTE
  ADD CONSTRAINT rute_fk1 FOREIGN KEY(endestasjon1)
REFERENCES STASJON (stasjonsnr);
ALTER TABLE RUTE
  ADD CONSTRAINT rute_fk2 FOREIGN KEY(endestasjon2)
REFERENCES STASJON (stasjonsnr);
ALTER TABLE RUTETRASE
  ADD CONSTRAINT rutetrase_fk1 FOREIGN KEY(rutenr)
REFERENCES RUTE (rutenr);
ALTER TABLE RUTETRASE
  ADD CONSTRAINT rutetrase_fk2 FOREIGN KEY(banenavn)
REFERENCES BANE (banenavn);
ALTER TABLE STOPPESTED
  ADD CONSTRAINT stoppested_fk1 FOREIGN KEY(rutenr)
REFERENCES RUTE (rutenr);
ALTER TABLE STOPPESTED
  ADD CONSTRAINT stoppested_fk2 FOREIGN KEY(stasjonsnr)
REFERENCES STASJON (stasjonsnr);